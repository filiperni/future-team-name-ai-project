<!DOCTYPE html>
<html lang="en">
	<title id="title_test">hello world</title>
	<head>
		<title>KML</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css"
			type="text/css"
		/>
		<link rel="stylesheet" href="./style.css" type="text/css" />
		<style></style>
		<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
	</head>

	<body>
		<div id="map" class="map"></div>
		<div id="popup" class="ol-popup"></div>
		<div id="info">&nbsp;</div>
		<!-- create two input objects -->
		<input type="text" id="lonbox" name="lonbox" />
		<input type="text" id="lanbox" name="lanbox" />
		<script type="text/javascript">
			var osm = new ol.layer.Tile({
				source: new ol.source.OSM(),
			});

			//moze na start wziąć teraźniejszą lokalizację
			var start_coordinates = {
				x: 18.606624528808595,
				y: 54.38186473556618,
			};
			var map = new ol.Map({
				layers: [osm],
				target: document.getElementById("map"),
				view: new ol.View({
					center: ol.proj.fromLonLat([
						start_coordinates.x,
						start_coordinates.y,
					]),
					zoom: 12,
				}),
			});

			map.on("singleclick", function (evt) {
				var lonlat = ol.proj.transform(
					evt.coordinate,
					"EPSG:3857",
					"EPSG:4326"
				);
				var x = lonlat[0];
				var y = lonlat[1];
				console.log(x, y);
				fetch(`http://127.0.0.1:8000/?x=${x}&y=${y}`)
					.then(response => {
						return response.json();
					})
					.then(res => {
						console.log(res);
					});
			});
		</script>
	</body>
</html>
